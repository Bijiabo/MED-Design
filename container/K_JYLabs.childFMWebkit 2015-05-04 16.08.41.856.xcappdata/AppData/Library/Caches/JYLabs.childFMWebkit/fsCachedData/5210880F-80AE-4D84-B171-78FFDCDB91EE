!function(){function e(e){var t=top.location,n={protocol:t.protocol.substring(0,t.protocol.length-1),hostname:t.hostname,port:t.port||"80"},i=s.exec(e.url);if(i&&i.length){var r={protocol:i[1],hostname:i[2],port:i[3]||"80"};if(n.protocol!=r.protocol||n.hostname!=r.hostname||n.port!=r.port)e.dataType="jsonp",e.jsonp="jsoncallback"}}function t(e,t){var n=e+"_"+t;$("#"+n).remove(),u.tinfo("Iframe "+n+" removed")}var n=!1,i="1.0.2",r="_lgpassport_",o=0,a={remote:{}},s=(document.getElementById(r),/^(https?):\/\/((?:[\u4E00-\u9FA5a-z0-9.-]|%[0-9A-F]{2}){2,})(?::(\d+))?((?:\/(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})*)*)(?:\?((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?$/i),l={server:"http://passport.lagou.com",poplogin:"/login/login.json",poptransfer:"/ajaxLogin/frameGrant.html",autologin:"/ajaxLogin/login.html"},u={rpc:function(t){if(t.url){t.type||(t.type="POST"),t.params||(t.params={});var n=arguments.callee;u.tinfo("Start passport.rpc: "+t.url);var i={type:t.type,data:t.params,url:t.url,dataType:"json"};e(i),$.ajax(i).done(function(e,i){if(u.tinfo("passport.rpc.succ: "+i),"10001"==e.state)return void PASSPORT.remote(e.content.data.crossServiceUrl,function(){u.tinfo("passport.rpc.remote.succ"),n(t)},function(e){u.tinfo("passport.rpc.remote.fail"),t.fail&&t.fail.apply(null,[e])});else return void(t.succ&&t.succ.apply(null,arguments))}).fail(function(e,n){u.tinfo("passport.rpc.fail: "+n),t.fail&&t.fail.apply(null,arguments)})}},getTargetUrl:function(e,t){var n={fl:void 0!=t.fl?t.fl:!0,service:t.service,osc:t.osc,ofc:t.ofc,pfurl:u.getCurEncodeUrl()};return e+"?"+$.param(n)},getCurEncodeUrl:function(){return encodeURIComponent(document.URL)},createIframe:function(e,t){var n='<iframe src="'+t+'" id="'+e+"_"+o+'" style="display:none;"></iframe>';$("body").append(n),o++},requester:function(e,t){e.dataType=e.dataType||"json",e.type=e.type||"POST",e.data=e.data||{},$.ajax(e).done(function(e){t&&t(e)})},tipheader:"Lagou Passport v"+i+" -> ",tip:function(){if(n){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}},tinfo:function(e){u.tip("info",u.tipheader+e)}};u.tinfo("Enter passport...");var c=function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var r=n[e].length;if(r>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+r+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var r,o=0;o<i.length;o++)if(r=i[o],r===t||r.listener===t){i.splice(o,1);break}return this},t.emit=function(e){var t=this._getEvents(),n=t[e],i=Array.prototype.slice.call(arguments,1);if(n){n=n.slice(0);for(var r=0,o=n.length;o>r;r++)n[r].apply(this,i)}return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t},e}(),d=!0,f=new c,p=function(e){return function(){var t=70,n=arguments;if(!d)window.setTimeout(function(){n.callee.apply(null,n)},t);else e.apply(null,n)}};window.PASSPORT=window.PASSPORT||{on:function(){f.on.apply(f,arguments)},auto:p(function(){var e=u.getCurEncodeUrl(),t=u.getTargetUrl(l.server+l.autologin,{fl:"1",service:e,osc:"PASSPORT._ascb("+o+")",ofc:"PASSPORT._afcb("+o+")"});u.createIframe("auto_login_iframe",t)}),_ascb:function(e,n){u.tinfo("Call of PASSPORT._ascb"+e+": "+n),f.emit("autologin:succ",n),t("auto_login_iframe",e)},_afcb:function(e,n){u.tinfo("Call of PASSPORT._afcb"+e+": "+n),f.emit("autologin:fail",n),t("auto_login_iframe",e)},remote:p(function(e,t,n){if(u.tinfo("Remote request: "+e+" "+t+" "+n),a.remote[o]={},t)a.remote[o].succ=t;if(n)a.remote[o].fail=n;u.tinfo("Remote request put into callbacks: "+JSON.stringify(a.remote));var i=u.getTargetUrl(l.server+l.autologin,{fl:"3",service:e,osc:"PASSPORT._rscb("+o+")",ofc:"PASSPORT._rfcb("+o+")"});u.createIframe("remote_login_iframe",i)}),_rscb:function(e,n){u.tinfo("Call of PASSPORT._rscb"+e+": "+n),f.emit("remotelogin:succ",n),t("remote_login_iframe",e),a.remote[e]&&a.remote[e].succ&&a.remote[e].succ(n)},_rfcb:function(e,n){u.tinfo("Call of PASSPORT._rfcb"+e+": "+n),f.emit("remotelogin:fail",n),t("remote_login_iframe",e),a.remote[e]&&a.remote[e].fail&&a.remote[e].fail(n)},util:{rpc:p(u.rpc)}}}();